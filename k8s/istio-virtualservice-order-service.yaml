apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: order-service-vs
spec:
  hosts:
    - "*"
  gateways:
    - couponkill-gateway
  http:
    - match:
        - uri:
            prefix: /order
      route:
        - destination:
            host: couponkill-order-service
            port:
              number: 8082
      retries:
        attempts: 1
        perTryTimeout: 2s
      timeout: 10
# VirtualService配置文件，用于定义服务网格中的路由规则和服务访问策略
#
# 参数说明:
# apiVersion: 指定使用的Istio API版本为networking.istio.io/v1beta1
# kind: 资源类型为VirtualService，用于配置虚拟服务
# metadata: 资源元数据配置
#   name: 虚拟服务名称，设置为order-service-vs
# spec: 虚拟服务的具体配置规范
#   hosts: 定义服务主机列表，"*"表示匹配所有主机
#   gateways: 指定关联的网关列表，这里关联couponkill-gateway网关
#   http: HTTP路由规则配置数组
#     match: 路由匹配条件配置
#       uri: URI匹配规则
#         prefix: 路径前缀匹配，匹配/order开头的请求路径
#     route: 路由目标配置
#       destination: 目标服务配置
#         host: 目标服务主机名，指向couponkill-order-service服务
#         port: 目标服务端口配置
#           number: 端口号设置为8082
#     retries: 重试策略配置
#       attempts: 重试次数设置为1次
#       perTryTimeout: 每次重试超时时间设置为2秒
#     timeout: 整体请求超时时间设置为10秒

