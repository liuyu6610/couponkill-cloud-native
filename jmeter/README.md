# CouponKill 秒杀系统 JMeter 性能测试方案

## 1. 测试目标

测试 CouponKill 秒杀系统在高并发场景下的性能表现，测量系统处理秒杀请求的最大 QPS（每秒查询率）。

## 2. 测试环境准备

### 2.1 系统服务启动

确保以下服务已正常启动：
- 用户服务 (user-service)
- 优惠券服务 (coupon-service)
- 订单服务 (order-service)
- 网关服务 (gateway)
- 中间件服务 (Nacos, Sentinel, RocketMQ, Redis, MySQL)

### 2.2 初始化测试数据

测试数据已预先创建，无需额外插入。

```sql
```
## 3. JMeter 测试脚本说明

### 3.1 测试计划结构

测试计划包含以下主要组件：
- **线程组**: 模拟并发用户
- **CSV数据文件设置**: 提供测试用户ID
- **HTTP默认请求**: 设置请求默认参数
- **HTTP头管理器**: 设置请求头信息
- **秒杀请求**: 执行秒杀操作
- **监听器**: 收集测试结果

### 3.2 线程组配置

- 线程数: 500 (模拟500个并发用户)
- Ramp-Up时间: 30秒 (在30秒内启动所有线程)
- 循环次数: 1 (每个用户只执行一次秒杀)

### 3.3 测试执行流程

1. 从CSV文件读取用户ID
2. 直接使用预设Token和用户ID调用 `/order/seckill` 接口执行秒杀
3. 收集测试结果并生成报告

## 4. 执行测试

### 4.1 Windows 系统

双击运行 `run_test.bat` 脚本，或在命令行中执行：

```cmd
run_test.bat
```

### 4.2 其他系统

在终端中执行以下命令：

```bash
# 确保JMeter已安装并配置到PATH环境变量中
jmeter -n -t seckill_test_plan.jmx -l seckill_test_results.jtl -j jmeter.log

# 生成HTML测试报告
jmeter -g seckill_test_results.jtl -o report
```

## 5. 测试结果分析

测试完成后，将在 `report` 目录中生成HTML格式的测试报告，包含以下关键指标：

- **Samples**: 总请求数
- **Average**: 平均响应时间
- **Min**: 最小响应时间
- **Max**: 最大响应时间
- **Error %**: 错误率
- **Throughput**: 吞吐量（QPS）
- **Received KB/sec**: 每秒接收数据量
- **Sent KB/sec**: 每秒发送数据量

## 6. 性能调优建议

根据测试结果，可以考虑以下优化方向：

1. **服务扩容**: 增加服务实例数量
2. **数据库优化**: 调整连接池大小，优化SQL语句和索引
3. **Redis优化**: 调整连接池和配置参数
4. **JVM调优**: 调整堆内存大小和垃圾回收策略
5. **限流配置**: 调整Sentinel限流规则
6. **网关优化**: 调整网关路由和负载均衡策略

## 7. 注意事项

1. 确保测试环境与生产环境配置相似
2. 测试前备份数据库，避免影响正常业务数据
3. 监控系统资源使用情况，避免因压测导致系统过载
4. 多次测试取平均值，确保测试结果准确性
5. 测试完成后清理测试数据